function BuscarFacturas(){var a=$("#idcliente").val(),t=$("#lote").val(),e=$("#cliente").val().split("-"),l="false";l=parseFloat(e[2])>0||parseFloat(e[1])>0||parseFloat(e[0])>0?"true":"false",$.ajax({url:"ajax/ingresos/facturas.php",data:{cli:a,lote:t,esfact:l}}).done(function(a){$("#tablafacturas").html(""),$("#tablatarjetas tbody").html(""),$("#control_tarjetas_cliente").val(1),console.log(a),$(".line_det").remove();for(var t=JSON.parse(a),e=0;e<t.length;e++){$("#tot_"+t[e].id).length;var l="";if(""!=t[e].tarjeta&&null!=t[e].tarjeta&&"null"!=t[e].tarjeta)var n="("+t[e].tarjeta+")",i="none",o="readonly",s=(l="none","_");else n="",i="inline-block",o="",l="",s="";0==t[e].id&&(l="none");var r="<tr class='line_det factura_con_tarjeta_"+t[e].id+"' style='display:"+l+"'><td style='text-align:left;'><input name='factID[]' value='"+t[e].num+"' style='display:none;'/><input name='CuentaCliente[]' value='"+t[e].cuentacli+"' style='display:none;'/><input name='factIDReal[]' value='"+t[e].id+"' style='display:none;'/>"+t[e].num+" "+n+"</td><td style='text-align:center;'>"+t[e].fecha+"</td><td style='text-align:center;'>"+t[e].lote+"</td><td style='text-align:right;' id='tot_"+t[e].id+"'>"+parseFloat(t[e].total).toFixed(2)+"</td><td style='text-align:right;' id='abo_"+t[e].id+"'>"+parseFloat(t[e].abono).toFixed(2)+"</td><td style='text-align:right;' id='sal_"+t[e].id+"'>"+parseFloat(t[e].saldo).toFixed(2)+"</td><td style='text-align:center;'><input onclick='this.select();' class='input-sm form-control misabonos' name='abonosval[]' onkeyup='CalcularSaldo("+t[e].id+");' value='0.00' id='newabo_"+t[e].id+s+"' "+o+"/><div onclick='SaldoTotal("+t[e].id+");' class='btn btn-xs btn-primary' style='display: "+i+";'><span class='glyphicon glyphicon-check'></span></div></td><td style='text-align:center;'><input class='input-sm form-control' id='saldof_"+t[e].id+s+"' value='"+parseFloat(t[e].saldo).toFixed(2)+"' readonly style='text-align:right;' /></td></tr>";$("#tablafacturas").append(r)}}),$("#saldoagregar").val(0),AgregaraIngreso()}function BuscarFacturasTar(){var a=$("#idcliente").val(),t=$("#lote").val();$.ajax({url:"ajax/ingresos/facturastar.php",data:{cli:a,lote:t}}).done(function(a){console.log(a),$(".line_det").remove();for(var t=JSON.parse(a),e=0;e<t.length;e++)if(0==$("#tot_"+t[e].id).length){var l="<tr class='line_det'><td style='text-align:right;'><input name='factID[]' value='"+t[e].num+"' style='display:none;'/><input name='CuentaCliente[]' value='"+$("#idcuentac").val()+"' style='display:none;'/><input name='factIDReal[]' value='"+t[e].id+"' style='display:none;'/>"+t[e].num+"</td><td style='text-align:center;'>"+t[e].fecha+"</td><td style='text-align:center;'>"+t[e].lote+"</td><td style='text-align:right;' id='tot_"+t[e].id+"'>"+parseFloat(t[e].total).toFixed(2)+"</td><td style='text-align:right;' id='abo_"+t[e].id+"'>"+parseFloat(t[e].abono).toFixed(2)+"</td><td style='text-align:right;' id='sal_"+t[e].id+"'>"+parseFloat(t[e].saldo).toFixed(2)+"</td><td style='text-align:center;'><input onclick='this.select();' class='input-sm form-control misabonos' name='abonosval[]' onkeyup='CalcularSaldo("+t[e].id+");' value='0.00' id='newabo_"+t[e].id+"'/><div onclick='SaldoTotal("+t[e].id+");' class='btn btn-xs btn-primary'><span class='glyphicon glyphicon-check'></span></div></td><td style='text-align:center;'><input class='input-sm form-control' id='saldof_"+t[e].id+"' value='"+parseFloat(t[e].saldo).toFixed(2)+"' readonly style='text-align:right;' /></td></tr>";$("#tablafacturas").append(l)}}),$("#saldoagregar").val(0),AgregaraIngreso()}function BuscarFacturaNum(){var a=$("#idcliente").val();$.ajax({url:"ajax/ingresos/facturanum.php",data:{fact:a}}).done(function(a){console.log(a),$(".line_det").remove();for(var t=JSON.parse(a),e=0;e<t.length;e++)if(console.log("entra"+t[e].lote),0==$("#tot_"+t[e].id).length){var l="<tr class='line_det'><td style='text-align:right;'><input name='factID[]' value='"+t[e].num+"' style='display:none;'/><input name='CuentaCliente[]' value='"+t[e].cuentacliente+"' style='display:none;'/><input name='factIDReal[]' value='"+t[e].id+"' style='display:none;'/>"+t[e].num+"</td><td style='text-align:center;'>"+t[e].fecha+"</td><td style='text-align:center;'>"+t[e].lote+"</td><td style='text-align:right;' id='tot_"+t[e].id+"'>"+parseFloat(t[e].total).toFixed(2)+"</td><td style='text-align:right;' id='abo_"+t[e].id+"'>"+parseFloat(t[e].abono).toFixed(2)+"</td><td style='text-align:right;' id='sal_"+t[e].id+"'>"+parseFloat(t[e].saldo).toFixed(2)+"</td><td style='text-align:center;'><input onclick='this.select();' class='input-sm form-control misabonos' name='abonosval[]' onkeyup='CalcularSaldo("+t[e].id+");' value='0.00' id='newabo_"+t[e].id+"'/><div onclick='SaldoTotal("+t[e].id+");' class='btn btn-xs btn-primary'><span class='glyphicon glyphicon-check'></span></div></td><td style='text-align:center;'><input class='input-sm form-control' id='saldof_"+t[e].id+"' value='"+parseFloat(t[e].saldo).toFixed(2)+"' readonly style='text-align:right;'/></td></tr>";$("#tablafacturas").append(l)}}),$("#saldoagregar").val(0),AgregaraIngreso()}function CalcularSaldo(a){var t=parseFloat($("#newabo_"+a).val()),e=parseFloat($("#sal_"+a).html());(null==t||isNaN(t))&&(t=0,$("#newabo_"+a).val("0.00"),$(".newabo_"+a).val("0.00")),t>e&&(t=e,$("#newabo_"+a).val(t),$("#newabo_"+a).effect("highlight"),$(".newabo_"+a).val(t),$(".newabo_"+a).effect("highlight"));var l=e-t;$("#saldof_"+a).val(l.toFixed(2)),$(".saldof_"+a).val(l.toFixed(2));var n=0;$(".misabonos").each(function(){var a=$(this).parent().parent(),t=$(a).find("input[name='factID[]']");console.log(a),console.log($(a).find("input[name='factID[]']")),console.log($(t).val());$(t).val().indexOf("(NC)")>=0?n-=parseFloat($(this).val()):n+=parseFloat($(this).val())}),$("#saldoagregar").val(n.toFixed(2)),AgregaraIngreso()}function SaldoTotal(a){$("#newabo_"+a).val($("#sal_"+a).html()),$(".newabo_"+a).val($("#sal_"+a).html()),CalcularSaldo(a)}function AgregaraIngreso(){var t=parseFloat($("#saldoagregar").val()),e=parseFloat($("#saldodirecto").val()),l=0;null!=$("#saldoagregar2").val()&&""!=$("#saldoagregar2").val()&&(l=parseFloat($("#saldoagregar2").val())),isNaN(l)&&(l=0),console.log(t+"/"+e+"/"+l),$("#totaldebe").val((e+t-l).toFixed(2)),separadorDecimalesInicial=".",separadorDecimales=".",separadorMiles=",";var n=(e+t-l).toFixed(2);$("#totaldebe1").val(function(t){var e="";for(t=""+t,partes=t.split(separadorDecimalesInicial),entero=partes[0],partes.length>1&&(decimal=partes[1]),cifras=entero.length,cifras2=cifras,a=0;a<cifras;a++)cifras2-=1,e+=entero.charAt(a),cifras2%3==0&&0!=cifras2&&(e+=separadorMiles);return partes.length>1&&(e+=separadorDecimales+decimal),e}(n)),parseFloat($("#totaldebe").val())>0?$("#verretencion").fadeIn():parseInt($("#idcliente").val())>0?$("#verretencion").fadeIn():$("#verretencion").fadeOut()}$(document).ready(function(){$("#cliente").autocomplete({source:"ajax/ingresos/clientes.php",select:function(a,t){console.log(t.item.id),$("#idcliente").val(t.item.id),$("#idcuentac").val(t.item.idcuenta),$("#escliente").val(t.item.tipodato),parseInt($("#idcliente").val())>0&&$("#verretencion").fadeIn(),1==t.item.tipodato?BuscarFacturas():2==t.item.tipodato?BuscarFacturasTar():BuscarFacturaNum()}})});